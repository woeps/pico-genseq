# Dependencies & Requirements

## Overview

This guide covers all necessary dependencies and requirements to work with the GenSeq codebase, including software setup, hardware requirements, and development environment configuration.

## Software Requirements

### Operating System Support

- **Linux**: Primary development platform (tested on Ubuntu/Debian)
- **Windows**: Supported via WSL2 or native
- **macOS**: Supported with Homebrew installation

### Pico SDK

The Raspberry Pi Pico SDK is the core dependency.

#### Installation

```bash
# Download and run installer
wget https://raw.githubusercontent.com/raspberrypi/pico-setup/master/pico_setup.sh
chmod +x pico_setup.sh
./pico_setup.sh

# Or manual installation
git clone -b master https://github.com/raspberrypi/pico-sdk.git
cd pico-sdk
git submodule update --init
cd ..
```

#### Directory Structure
```
~/.pico-sdk/
├── sdk/2.1.1/           # Pico SDK
├── toolchain/14_2_Rel1/  # ARM GCC toolchain
├── picotool/2.1.1/      # Pico utility tool
├── cmake/v3.31.5/       # CMake
├── ninja/v1.12.1/       # Ninja build system
└── openocd/0.12.0+dev/  # OpenOCD for debugging
```

#### Environment Variables
```bash
export PICO_SDK_PATH=~/.pico-sdk/sdk/2.1.1
export PICO_TOOLCHAIN_PATH=~/.pico-sdk/toolchain/14_2_Rel1
```

### ARM Toolchain

The ARM GNU toolchain is required for cross-compilation.

#### Included in Pico SDK
- Version: 14.2 Rel1
- Target: arm-none-eabi
- Location: `~/.pico-sdk/toolchain/14_2_Rel1/`

#### Manual Installation (if needed)
```bash
# Download from ARM website
wget https://developer.arm.com/-/media/Files/downloads/gnu/14.2.rel1/binrel/arm-gnu-toolchain-14.2.rel1-x86_64-arm-none-eabi.tar.xz

# Extract to toolchain directory
tar -xf arm-gnu-toolchain-14.2.rel1-x86_64-arm-none-eabi.tar.xz -C ~/.pico-sdk/toolchain/
```

### Build Tools

#### CMake
- Version: 3.13 or higher
- Included: `~/.pico-sdk/cmake/v3.31.5/bin/cmake`
- System package: `sudo apt install cmake`

#### Ninja
- Version: 1.10 or higher
- Included: `~/.pico-sdk/ninja/v1.12.1/ninja`
- System package: `sudo apt install ninja-build`

## Development Environment

### VSCode Setup

#### Required Extensions
1. **Raspberry Pi Pico** - Official Pico extension
2. **C/C++ clangd** - Language server (NOT IntelliSense)
3. **Cortex-Debug** - ARM debugging support
4. **CMake Tools** - (Optional, not used in this project)

#### Configuration Files

`.vscode/settings.json` key settings:
```json
{
    "C_Cpp.intelliSenseEngine": "disabled",
    "C_Cpp.autocomplete": "disabled",
    "C_Cpp.errorSquiggles": "disabled",
    "clangd.arguments": [
        "--query-driver=${env:HOME}/.pico-sdk/toolchain/14_2_Rel1/bin/arm-none-eabi-*",
        "--compile-commands-dir=${workspaceFolder}/build",
        "--header-insertion=never"
    ]
}
```

#### clangd Configuration

`.clangd` file in project root:
```yaml
CompileFlags:
  CompilationDatabase: build
  BuiltinHeaders: QueryDriver
```

This enables:
- Proper code completion
- Go to definition
- Error checking
- Refactoring support

### Windsurf IDE Integration

The project is optimized for Windsurf IDE:
- Uses clangd for language support
- Requires absolute paths in settings
- Compilation database generated by CMake

## Hardware Requirements

### Minimum Requirements

1. **Raspberry Pi Pico** (RP2040)
   - 264KB SRAM
   - 2MB Flash storage
   - Dual-core ARM Cortex-M0+

2. **Micro USB Cable**
   - For power and programming
   - Data-capable cable required

### Recommended Development Setup

1. **Two Pico Boards**
   - One for target (GenSeq)
   - One for PicoProbe (debugging)

2. **Hardware Components**
   - LCD Display (HD44780 with FC113 controller)
   - Rotary Encoder with button
   - Push buttons (16 total)
   - LED matrix (16x2)
   - MIDI interface hardware

3. **Debug Hardware**
   - PicoProbe setup
   - SWD connection wires
   - Optional: Logic analyzer

### Pin Assignments

From `src/genseq.cpp`:
```cpp
// BUTTONS
#define BUTTON_E_PIN 20  // Encoder button
#define BUTTON_A_PIN 21  // Additional button

// ENCODER
#define ENCODER_PIN_A 14
#define ENCODER_PIN_B 15
#define ENCODER_PIO pio0
#define ENCODER_SM 0

// DISPLAY (I2C)
#define DISPLAY_I2C i2c0
#define DISPLAY_PIN_SDA 4
#define DISPLAY_PIN_SCL 5
#define DISPLAY_I2C_ADDR 0x27

// MIDI UART
#define MIDI_UART uart1
#define MIDI_UART_PIN_TX 8
#define MIDI_UART_PIN_RX 9

// STATUS LED
#define LED_PIN 25
```

## Optional Dependencies

### Git

For version control:
```bash
# Ubuntu/Debian
sudo apt install git

# Configuration
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

### Serial Monitor

For debugging output:
```bash
# Python-based
pip install pyserial

# Or use minicom
sudo apt install minicom
```

### Logic Analyzer (Optional)

For advanced debugging:
- Saleae Logic Analyzer
- PulseView with sigrok
- DSLogic

## Setup Verification

### 1. Verify SDK Installation

```bash
# Check SDK path
ls $PICO_SDK_PATH

# Check toolchain
ls $PICO_TOOLCHAIN_PATH/bin/arm-none-eabi-gcc

# Test compilation
arm-none-eabi-gcc --version
```

### 2. Verify Build System

```bash
cd /home/chris/Projects/c/pico/genseq
mkdir -p build
cd build
cmake ..
ninja
```

### 3. Verify clangd

```bash
# Check if clangd is running in VSCode
# Look for clangd status in bottom bar
# Test code completion in a .cpp file
```

### 4. Verify Hardware

```bash
# Check if Pico is detected
lsusb | grep "RP2"

# Check serial ports
ls /dev/ttyACM*

# Test with picotool
picotool info
```

## Common Setup Issues

### Permission Issues (Linux)

```bash
# Add user to dialout group for serial access
sudo usermod -a -G dialout $USER
# Logout and login again

# Or use sudo for development (not recommended)
```

### Path Issues

Ensure toolchain is in PATH:
```bash
export PATH=$PATH:$PICO_TOOLCHAIN_PATH/bin
```

### VSCode Extension Conflicts

- Disable Microsoft C/C++ IntelliSense
- Use only clangd for Pico development
- Restart VSCode after changing extensions

### Windows Specific

- Use WSL2 for best experience
- Install Windows Terminal
- Configure WSL2 for USB passthrough

## Development Workflow Setup

### 1. Clone Repository
```bash
git clone https://github.com/woeps/pico-genseq.git
cd pico-genseq
```

### 2. Open in VSCode
```bash
code .
```

### 3. Build Project
- Use `Ctrl+Shift+P` → "Tasks: Run Task" → "Build"
- Or use terminal: `cd build && ninja`

### 4. Flash Firmware
- Use USB method for initial flash
- Set up PicoProbe for development

## Performance Considerations

### Build Performance

1. **SSD Storage**: Faster build times
2. **RAM**: 8GB+ recommended for large projects
3. **CPU**: Multi-core helps with parallel builds

### Development Experience

1. **Clangd**: Provides fast code analysis
2. **Hardware Debugging**: PicoProbe essential
3. **Serial Output**: Useful for debugging

## Summary

To work with the GenSeq codebase, you need:
- Pico SDK with toolchain
- VSCode with clangd
- At least one Pico board
- Basic electronic components

The setup is designed to be straightforward with the Pico SDK installer handling most dependencies. The development environment is optimized for Windsurf/VSCode with clangd providing intelligent code assistance.
